<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
    <script defer src="./js/foildest.js"></script>
    <script src="./js/helpers/parser.js"></script>
    <script defer src="./js/helpers/template.js"></script>
    
    <script defer>

        window.onload = async function() {
            
          
            /*DOM elements*/
            //const URI = 'https://www.viajanet.com.br/busca/passagens/voos#';
            //https://www.viajanet.com.br/busca/passagens/voos#/BSB/CGH/RT/05-04-2019/08-04-2019/-/-/-/1/null/null/-/-/-/-
            var URI = 'https://www.viajanet.com.br/busca/passagens/voos#/[FROM]/[TO]/RT/[DATE_DEPARTURE]/[DATE_RETURN]/-/-/-/1/null/null/-/-/-/-';
            
            const divRowCards = document.querySelector('#row-cards');
            const btnFoilTrek = document.querySelector('#btn-foil-trek');

            btnFoilTrek.onclick = async () => {
               
                let elements = getDomElements('trekForm');
                let trekObj = resolveDomMapping(elements);

                let foils = await foil(trekObj);
              
                let strHTML = getTemplate();
               
                foils.map((trek,idx)=> {
                    
                    let trekRouteDepart = trek[0][0];
                    let trekRouteArrive = trek[1][0];

                    let arrRouteTrek = trekRouteDepart.split('-');
                    let trekRoute = trekRouteDepart + '-' + trekRouteArrive;

                    arrRouteTrek.length < 2 && (arrRouteTrek = trekRoute.split('-'));
                 
                    trekRoute = trekRoute + '-' + trekRouteDepart;

                    let uriTrek = mapReplace({
                          '[FROM]':arrRouteTrek[0]
                        , '[TO]':arrRouteTrek[1]
                        , '[DATE_DEPARTURE]':trek[0][3].toString().replace(/\//g,'-')
                        , '[DATE_RETURN]':trek[1][3].toString().replace(/\//g,'-')
                      },URI)
                 
               
                    let date01 = '[DATE-01-'+idx+']';
                    let date02 = '[DATE-02-'+idx+']';
                    let cardURI = '[CARD-URI-PAIR-'+idx+']';
                    let cardTitle = '[CARD-TITLE-PAIR-'+idx+']';

                    let params = {};
        
                    params[date01] = trek[0][3];
                    params[date02] = trek[1][3];
                    params[cardURI] = uriTrek;
                    params[cardTitle] = trekRoute;

                    strHTML =  mapReplace(params,strHTML);
                })
                
                let domNode = apllyDom(strHTML);
                let arrDom = new Array(2);
        
                (divRowCards.childNodes && divRowCards.childNodes.length > 0) ? divRowCards.insertBefore(domNode, divRowCards.childNodes[0]) : divRowCards.appendChild(domNoded);

            }

  
        }
    </script>

    <title>Foiltrek</title>
  </head>
  <body>
  <!-- Page Content -->
  <div class="container">

    <!-- Page Heading -->
    <h1 class="my-4">Foil your destinations
      <small>&nbsp;</small>
    </h1>

    <form>
      <div class="form-group">
        <label for="exampleInputEmail1">Aeroporto de Origem</label>
        <input type="text" class="form-control" id="exampleInputEmail1" maxlength="3" aria-describedby="origemHelp">
        <small id="origemHelp" class="form-text text-muted">Sigla do aeroporto em 3 letras maiúsculas</small>
      </div>
      <div class="form-group">
        <label for="exampleInputEmail1">Aeroporto de Destino</label>
        <input type="text" class="form-control" id="exampleInputEmail1" maxlength="3" aria-describedby="destinoHelp">
        <small id="destinoHelp" class="form-text text-muted">Sigla do aeroporto em 3 letras maiúsculas</small>
      </div>
      <div class="form-check">
        <input type="radio" class="form-radio-input" id="rtRadio" checked>
        <label class="form-radio-label" for="rtRadio">Ida e Volta</label>
      </div>
      <button type="submit" class="btn btn-primary">Submit</button>
    </form>


    <form id="trekForm">
        <div class="form-row align-items-center">
            <div class="col-auto">
                <label class="sr-only" for="iptFrom01">Username</label>
                <div class="input-group mb-2">
                  <div class="input-group-prepend">
                    <div class="input-group-text">Origem</div>
                  </div>
                  <input type="text" class="form-control" id="iptFrom01" name="iptFrom01" placeholder="Origem" value="BSB">
                </div>
            </div>
          <div class="col-auto">
            <label class="sr-only" for="inlineFormInputGroup">Username</label>
            <div class="input-group mb-2">
              <div class="input-group-prepend">
                <div class="input-group-text">Destino</div>
              </div>
              <input type="text" class="form-control" id="iptTo01" name="iptTo01" placeholder="Destino" value="CGH">
            </div>
          </div>
          <div class="col-auto">
            <div class="form-radio mb-2">
              <input class="form-radio-input" type="radio" id="autoSizingCheck" checked>
              <label class="form-check-label" for="autoSizingCheck">
                Ida e Volta
              </label>
            </div>
          </div>
          <div class="col-auto">
            <button type="button" id="btn-foil-trek" class="btn btn btn-outline-primary mb-2">Expand it</button>
          </div>
        </div>
        <div>
            <input type="date" name="dateDeparture">
            <input type="date" name="dateReturn">
        </div>
      </form>
    
    <span class="mb-4" ></span>
    <div id="row-cards" class="card-columns" >
    </div>



  </div>
  <!-- /.container -->

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>
  </body>
</html>